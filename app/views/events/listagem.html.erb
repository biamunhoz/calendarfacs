<script type="text/javascript">
  $(document).ready(function() {
      $('#eventolista').dataTable ({
          "iDisplayLength": 30, 
          "bPaginate": true,    
          "sPaginationType":"full_numbers", 
          "bJQueryUI":true,
          "bLengthChange":false, 
          "ordering":     true, 
          "aaSorting":    [[0, "asc"]],  
          "columnDefs": [
                    { "targets": [1],
                      "visible": true,
                      "orderData": [0]
                    },
                    { "targets": [0],
                      "visible": false
                    }
              ],   
          "oLanguage": { 
              "sInfo":              "Mostrando de _START_ até _END_ de _TOTAL_ registros",
              "sInfoFiltered":      "Filtrado de _MAX_ registros no total",
              "sInfoEmpty":         "Sem resultados",
              "sZeroRecords":       "Sem resultados",
              "sSearch":            "Buscar",
              "oPaginate": {
                  "sFirst":         "Primeiro",
                  "sPrevious":      "Anterior",
                  "sNext":          "Próximo",
                  "sLast":          "Ultimo"
              }
          }
      })
  })
</script>

<h1>Eventos</h1>

<table class="table table-bordered display" id="eventolista">
  <thead>
    <tr>
      <th></th>
      <th>Sala/Equipamento</th>
      <th>Título</th>
      <th>Registrado para</th>
      <th>Usuário que marcou</th>
      <th>Início</th>
      <th>Fim</th>

      <th>Ação</th>
      <th>Ação</th>
      <th>Ação</th>
      <th>Consulta</th>

    </tr>
  </thead>

  <tbody>
    <% @events.each do |event| %>
      <tr>
        <td><%= event.start_date.strftime("%Y/%m/%d") + " - " + event.timeini.strftime("%H:%M") %></td>
        <td><%= event.sala.nome %></td>
        <td><%= event.title %></td>
        <td><%= event.registropara %> </td>
        <td>
          <%= extrair_primeiro_nome(event.nomeUsuario) %> 
          <% if tempermissaosuperadmin(event.sala.id) %>
            : <%= event.usuario.emailPrincipalUsuario %> - <%= event.usuario.numeroTelefoneFormatado %>  <%= event.usuario.tel_contato %>
          <% end %>
        </td>
        <td><%= event.start_date.strftime("%d/%m/%Y") + " - " + event.timeini.strftime("%H:%M") %></td>
        <td><%= event.end_date.strftime("%d/%m/%Y") + " - " + event.timefim.strftime("%H:%M")  %></td>        
        <% if event.pendente == true %>
          <% if tempermissaosuperadmin(event.sala.id) %>
            <td><%= link_to 'Negar ', negarevento_path(event), data: { confirm: 'Essa ação irá apagar todos os agendamentos deste evento. Você tem certeza ?' } %> | <%= link_to 'Confirmar ', confirmarevento_path(event) %> </td>
          <% else %>
            <td style="color:red;">Esperando confirmação - ⧗ EA </td>
          <% end %>
        <% else %>
          <td style="color:green;"> Confirmado - Ⓥ </td>
        <% end %>
        <% if tempermissaosuperadmin(event.sala.id) %>
          <td><%= link_to 'Editar evento', edit_event_path(event), class: 'btn btn-warning'  %></td>
          <td><%= link_to 'Apagar evento', event, method: :delete, data: { confirm: 'Essa ação irá apagar todos os agendamentos deste evento. Você tem certeza ?' }, class: 'btn btn-danger' %></td>
          <td><%= link_to 'Agendamentos', agendamentos_path(event), class: 'btn btn-light'  %> </td>
        <% else %>
          <% if event.usuario_id == current_user.id %>
            <td><%= link_to 'Editar evento', edit_event_path(event), class: 'btn btn-warning'  %></td>

            <% if event.sala.permitiapagarevento == true %>
              <td><%= link_to 'Apagar evento', event, method: :delete, data: { confirm: 'Essa ação irá apagar todos os agendamentos deste evento. Você tem certeza ?' }, class: 'btn btn-danger' %></td>
            <% else %>
              <td></td>
            <% end %>
            <td></td>
          <% else %>
            <td></td>
            <td></td>
            <td></td> 
          <% end %>       
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<br>